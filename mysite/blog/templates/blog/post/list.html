{% extends "blog/base.html" %}
{% load blog_tags %}

{% block title %}My Blog{% endblock %}

{% block content %}
    <h1>My Blog</h1>

    <div>
        <form method="get" action="{% url 'blog:post_search' %}" class="search-form">
            <input type="text" name="query">
            <input type="submit" value="Search">
        </form>

        {% if query %}
            <div class="search-meta">
                <p>Showing results for "<strong>{{ query }}</strong>"</p>
                <h4>
                    {% with posts.paginator.count as total_results %}
                        {{ total_results }} result{{ total_results|pluralize }} found
                    {% endwith %}
                </h4>
            </div>
        {% endif %}
    </div>

    {% if tag %}
        <p>Posts tagged with "<strong>{{ tag.name }}</strong>"</p>
    {% endif %}

    {% for post in posts %}
        <h2>
            <a href="{{ post.get_absolute_url }}">
                {{ post.title }}
            </a>
        </h2>
        {% if post.tags.exists %}
            <p class="tags">
                Tags:
                {% for tag in post.tags.all %}
                    <a href="{% url 'blog:post_list_by_tag' tag.slug %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>
        {% endif %}
        <p class="date">
            Published {{ post.publication_date }} by {{ post.author }}
        </p>
        {{ post.body|markdown|truncatewords_html:60 }}
    {% endfor %}
    {% include "pagination.html" with page=posts %}
{% endblock %}